#####################################################################
# 	Toolhead
#####################################################################
[mcu TH0]
canbus_uuid: 225077e58121

[adxl345]
cs_pin: TH0: PB12
spi_software_sclk_pin: TH0: PB10
spi_software_mosi_pin: TH0: PB11
spi_software_miso_pin: TH0: PB2
axes_map: x,y,z

[extruder]
step_pin: TH0: PD0
dir_pin: !TH0: PD1
enable_pin: !TH0: PD2
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 4.637
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: TH0: PB13
sensor_type: PT1000
pullup_resistor: 2200
sensor_pin: TH0: PA3
control: pid
pid_Kp: 33.597
pid_Ki: 8.959
pid_Kd: 31.497
min_temp: 0
max_temp: 315
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 5

#[filament_switch_sensor filament_runout]
#switch_pin: !TH0:PB3
#pause_on_runout: True
#runout_gcode: PAUSE

#[probe]
#pin: TH0:PB6
#x_offset: 0
#y_offset: 0
#z_offset: -0.930
#speed: 5.0
#samples: 3
#samples_result: median
#sample_retract_dist: 3.0
#samples_tolerance: 0.015
#samples_tolerance_retries: 3
#
#activate_gcode:
#    {% set PROBE_TEMP = 150 %}
#    {% set MAX_TEMP = PROBE_TEMP + 5 %}
#    {% set ACTUAL_TEMP = printer.extruder.temperature %}
#    {% set TARGET_TEMP = printer.extruder.target %}
#
#    {% if TARGET_TEMP > PROBE_TEMP %}
#        { action_respond_info('Extruder temperature target of %.1fC is too high, lowering to %.1fC' % (TARGET_TEMP, PROBE_TEMP)) }
#        M109 S{ PROBE_TEMP }
#    {% else %}
#        # Temperature target is already low enough, but nozzle may still be too hot.
#        {% if ACTUAL_TEMP > MAX_TEMP %}
#            { action_respond_info('Extruder temperature %.1fC is still too high, waiting until below %.1fC' % (ACTUAL_TEMP, MAX_TEMP)) }
#            TEMPERATURE_WAIT SENSOR=extruder MAXIMUM={ MAX_TEMP }
#        {% endif %}
#    {% endif %}

[tmc2209 extruder]
uart_pin: TH0: PA15
run_current: 0.650
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_fan Hotend]
pin: TH0: PA0
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0

[fan]
pin: TH0: PA1
max_power: 1.0
kick_start_time: 0.5
off_below: 0.13
cycle_time: 0.010